@let config = modal().config();

<div class="fm-modal--container">
  @if (overlayVisible()) {
    <div class="fm-modals--backdrop"></div>
  }

  @if (config.closable) {
    <!-- eslint-disable-next-line -->
    <div class="fm-modal--closing-layer" (click)="modal().close()"></div>
  }

  <div class="fm-modal--body-wrapper" [style]="bodyStyles()" #bodyWrapper>
    <div
      class="fm-modal--body"
      [class.no-border]="!theme().styling.frameBorder"
      [class.no-shadow]="!theme().styling.frameShadow"
      #body
    >
      <div class="fm-modal--header-wrapper">
        <div class="fm-modal--header-content">
          <ng-content select="fm-modal-instance-header" />
        </div>

        <ng-container *ngTemplateOutlet="headerActionsTpl" />
      </div>

      <div
        class="fm-modal--content"
        [class.scrollable]="config.scroll === 'content'"
      >
        @if (modal().loading()) {
          <fm-modal-instance-loader
            [modal]="modal()"
            @fadeInOutLoader
            [@.disabled]="!modal().loadingInfo().animation"
          />
        }

        <ng-content />
      </div>

      <ng-content select="fm-modal-instance-footer" />
    </div>
  </div>
</div>

<ng-template #headerActionsTpl>
  @let position = modal().maximized() ? 'inside' : theme().styling.headerActions;

  <div
    class="fm-modal--header-actions"
    [class]="'position-' + position"
    [class.corner]="!config.maximizable && config.closable"
    [@fadeInOutActions]="position"
  >
    @if (config.closable) {
      <div
        tabindex="0"
        class="fm-modal-close-btn"
        [class]="headerActionClasses()"
        (click)="modal().close()"
        (keydown.enter)="modal().close()"
      >
        <div class="icon-content">
          <span class="line"></span>
          <span class="line"></span>
        </div>
      </div>
    }

    @if (config.maximizable) {
      <div
        tabindex="0"
        class="fm-modal-maximize-btn"
        [class]="headerActionClasses()"
        [class.maximized]="modal().maximized()"
        (click)="modal().toggleMaximize()"
        (keydown.enter)="modal().toggleMaximize()"
      >
        <div class="icon-content">
          <span class="square top-square"></span>
          <span class="square bottom-square"></span>
        </div>
      </div>
    }
  </div>
</ng-template>
